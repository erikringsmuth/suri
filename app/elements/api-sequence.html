<!-- Copyright (C) 2014 Erik Ringsmuth <erik.ringsmuth@gmail.com> -->
<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/elements/api-sequence-menu.html">
<link rel="import" href="/elements/suri-tutorial.html">

<polymer-element name="api-sequence" propertyibutes="">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <div class="row">
      <div class="col-sm-3">
        <api-sequence-menu apisequence="{{apiSequence}}"></api-sequence-menu>
      </div>
      <div id="contentPlaceholder" class="col-sm-9">
        <suri-tutorial id="suriTutorial"></suri-tutorial>
      </div>
    </div>
  </template>
  <script>
    Polymer('api-sequence', {
      created: function() {
        this.apiSequence = [];
      },

      ready: function() {
        var newPanel = function newPanel(tagName, event) {
          // Hide the info panel
          this.$.suriTutorial.style.display = 'none';

          // Create and append a new panel of type 'xhr-panel' or 'code-panel'
          var panel = document.createElement(tagName);

          // Give it a reference to the API sequence
          panel.apiSequence = this.apiSequence;

          // Copy the properties over from the event detail
          for (var property in event.detail) {
            if (event.detail.hasOwnProperty(property)) {
              panel[property] = event.detail[property];
            }
          }

          // Add the panel to the API sequence and attach it to the document
          this.apiSequence.push(panel);
          this.$.contentPlaceholder.appendChild(panel);
        }.bind(this);

        // Listen to new panel events
        window.addEventListener('new-xhr-panel', newPanel.bind(null, 'xhr-panel'), true);
        window.addEventListener('new-code-panel', newPanel.bind(null, 'code-panel'), true);
      }
    });
  </script>
</polymer-element>
