// Copyright (C) 2014 Erik Ringsmuth <erik.ringsmuth@gmail.com>

define(["require","config","Ractive","rv!./userTemplate","layouts/search/layout","router","components/xhrPanel/xhrPanel","components/apiSequence/apiSequence","jquery"],function(e){var t=e("config"),n=e("Ractive"),r=e("rv!./userTemplate"),i=e("layouts/search/layout"),s=e("router"),o=e("components/xhrPanel/xhrPanel"),u=e("components/apiSequence/apiSequence"),a=e("jquery"),f=n.extend({template:r,init:function(){this.set("userId",s.routeArguments().id),this.set("myProfile",this.get("userId")===t.session.userId),a(".bs-tooltip").tooltip(),a.ajax("/users/"+this.get("userId")).done(function(e){this.set("emailMd5",e.emailMd5),this.set("displayName",e.displayName),a(".bs-tooltip").tooltip()}.bind(this)),a.ajax("/xhr?owner="+this.get("userId")).done(function(e){this.set("xhrs",e)}.bind(this));var e=new u({el:this.nodes["api-sequence"]});e.set("disableTutorial",!0),this.observe({filter:function(e){a.ajax("/xhr?owner="+this.get("userId")+"&q="+e.trim()).done(function(e){this.set("xhrs",e)}.bind(this))}}),this.on({teardown:function(){e.teardown()},openResult:function(t,n){new o({data:n})},editDisplayName:function(){this.set("editDisplayName",!0)},saveDisplayName:function(){this.set("editDisplayName",!1),a.ajax("/users/"+this.get("userId")+"/displayname",{type:"PUT",contentType:"application/json",data:JSON.stringify({displayName:this.get("displayName")})}).done(function(){t.session.displayName=this.get("displayName")}.bind(this)).fail(function(){this.set("displayName",t.session.displayName)}.bind(this))},cancelEditDisplayName:function(){this.set("displayName",t.session.displayName),this.set("editDisplayName",!1)}})},components:{}});return i.extend({components:{"content-placeholder":f}})});