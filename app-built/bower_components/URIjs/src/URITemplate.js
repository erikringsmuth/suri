/*!
 * URI.js - Mutating URLs
 * URI Template Support - http://tools.ietf.org/html/rfc6570
 *
 * Version: 1.12.1
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */

(function(e,t){typeof exports=="object"?module.exports=t(require("./URI")):typeof define=="function"&&define.amd?define(["./URI"],t):e.URITemplate=t(e.URI,e)})(this,function(e,t){function i(e){return i._cache[e]?i._cache[e]:this instanceof i?(this.expression=e,i._cache[e]=this,this):new i(e)}function s(e){this.data=e,this.cache={}}var n=t&&t.URITemplate,r=Object.prototype.hasOwnProperty,o=i.prototype,u={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return i._cache={},i.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,i.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,i.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,i.expand=function(e,t){var n=u[e.operator],r=n.named?"Named":"Unnamed",s=e.variables,o=[],a,f,l,c,h;for(l=0;f=s[l];l++){a=t.get(f.name);if(!a.val.length){a.type&&o.push("");continue}o.push(i["expand"+r](a,n,f.explode,f.explode&&n.separator||",",f.maxlength,f.name))}return o.length?n.prefix+o.join(n.separator):""},i.expandNamed=function(t,n,r,i,s,o){var u="",a=n.encode,f=n.empty_name_separator,l=!t[a].length,c=t.type===2?"":e[a](o),h,p,d;for(p=0,d=t.val.length;p<d;p++)s?(h=e[a](t.val[p][1].substring(0,s)),t.type===2&&(c=e[a](t.val[p][0].substring(0,s)))):l?(h=e[a](t.val[p][1]),t.type===2?(c=e[a](t.val[p][0]),t[a].push([c,h])):t[a].push([undefined,h])):(h=t[a][p][1],t.type===2&&(c=t[a][p][0])),u&&(u+=i),r?u+=c+(f||h?"=":"")+h:(p||(u+=e[a](o)+(f||h?"=":"")),t.type===2&&(u+=c+","),u+=h);return u},i.expandUnnamed=function(t,n,r,i,s,o){var u="",a=n.encode,f=n.empty_name_separator,l=!t[a].length,c,h,p,d;for(p=0,d=t.val.length;p<d;p++)s?h=e[a](t.val[p][1].substring(0,s)):l?(h=e[a](t.val[p][1]),t[a].push([t.type===2?e[a](t.val[p][0]):undefined,h])):h=t[a][p][1],u&&(u+=i),t.type===2&&(s?c=e[a](t.val[p][0].substring(0,s)):c=t[a][p][0],u+=c,r?u+=f||h?"=":"":u+=","),u+=h;return u},i.noConflict=function(){return t.URITemplate===i&&(t.URITemplate=n),i},o.expand=function(e){var t="";(!this.parts||!this.parts.length)&&this.parse(),e instanceof s||(e=new s(e));for(var n=0,r=this.parts.length;n<r;n++)t+=typeof this.parts[n]=="string"?this.parts[n]:i.expand(this.parts[n],e);return t},o.parse=function(){var e=this.expression,t=i.EXPRESSION_PATTERN,n=i.VARIABLE_PATTERN,r=i.VARIABLE_NAME_PATTERN,s=[],o=0,a,f,l;t.lastIndex=0;for(;;){f=t.exec(e);if(f===null){s.push(e.substring(o));break}s.push(e.substring(o,f.index)),o=f.index+f[0].length;if(!u[f[1]])throw new Error('Unknown Operator "'+f[1]+'" in "'+f[0]+'"');if(!f[3])throw new Error('Unclosed Expression "'+f[0]+'"');a=f[2].split(",");for(var c=0,h=a.length;c<h;c++){l=a[c].match(n);if(l===null)throw new Error('Invalid Variable "'+a[c]+'" in "'+f[0]+'"');if(l[1].match(r))throw new Error('Invalid Variable Name "'+l[1]+'" in "'+f[0]+'"');a[c]={name:l[1],explode:!!l[3],maxlength:l[4]&&parseInt(l[4],10)}}if(!a.length)throw new Error('Expression Missing Variable(s) "'+f[0]+'"');s.push({expression:f[0],operator:f[1],variables:a})}return s.length||s.push(e),this.parts=s,this},s.prototype.get=function(e){var t=this.data,n={type:0,val:[],encode:[],encodeReserved:[]},i,s,o;if(this.cache[e]!==undefined)return this.cache[e];this.cache[e]=n,String(Object.prototype.toString.call(t))==="[object Function]"?o=t(e):String(Object.prototype.toString.call(t[e]))==="[object Function]"?o=t[e](e):o=t[e];if(o===undefined||o===null)return n;if(String(Object.prototype.toString.call(o))==="[object Array]"){for(i=0,s=o.length;i<s;i++)o[i]!==undefined&&o[i]!==null&&n.val.push([undefined,String(o[i])]);n.val.length&&(n.type=3)}else if(String(Object.prototype.toString.call(o))==="[object Object]"){for(i in o)r.call(o,i)&&o[i]!==undefined&&o[i]!==null&&n.val.push([i,String(o[i])]);n.val.length&&(n.type=2)}else n.type=1,n.val.push([undefined,String(o)]);return n},e.expand=function(t,n){var r=new i(t),s=r.expand(n);return new e(s)},i});