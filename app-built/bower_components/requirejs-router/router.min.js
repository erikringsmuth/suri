define([],function(){var e={},t={statechange:[],routeload:[]},n="",r=function(){n!=window.location.href&&(n=window.location.href,i.fire("statechange"))},i={init:function(e){return"undefined"==typeof e&&(e={}),window.addEventListener?(window.addEventListener("popstate",r,!1),window.addEventListener("hashchange",r,!1)):(window.attachEvent("popstate",r),window.attachEvent("onhashchange",r)),e.loadCurrentRouteOnStateChange!==!1&&i.on("statechange",function(){i.loadCurrentRoute()}),e.fireInitialStateChange!==!1&&i.fire("statechange"),i},routes:{},activeRoute:{},registerRoutes:function(e){for(var t in e)e.hasOwnProperty(t)&&(i.routes[t]=e[t]);return i},on:function(e,n){return"undefined"==typeof t[e]&&(t[e]=[]),t[e].push(n),i},fire:function(e){if(t[e])for(var n=Array.prototype.slice.call(arguments,1),r=0;r<t[e].length;r++)t[e][r].apply(i,n);return i},off:function(e,n){if(t[e]){var r=t[e].indexOf(n);-1!==r&&t[e].splice(r,1)}return i},loadCurrentRoute:function(){for(var e in i.routes)if(i.routes.hasOwnProperty(e)){var t=i.routes[e];if(i.testRoute(t)){i.activeRoute.active=!1,t.active=!0,i.activeRoute=t,require([t.moduleId],function(e){t.active&&i.fire("routeload",e,i.routeArguments(t,window.location.href))});break}}return i},urlPath:function(t){if("undefined"!=typeof e[t])return e[t];var n=t.split("/"),r="/"+n.splice(3,n.length-3).join("/"),i=r.split(/[\?#]/)[0],s=r.indexOf("#");if(-1!==s){var o=r.substring(s).split("?")[0];"#/"===o.substring(0,2)?i=o.substring(1):"#!/"===o.substring(0,3)&&(i=o.substring(2))}return e[t]=i,i},testRoute:function(e,t){var n=i.urlPath(t||window.location.href);if(e.path===n||"*"===e.path)return!0;if(e.path instanceof RegExp)return e.path.test(n);if(-1===e.path.indexOf("*")&&-1===e.path.indexOf(":"))return!1;var r=n.split("/"),s=e.path.split("/");if(r.length!==s.length)return!1;for(var o in s)if(s.hasOwnProperty(o)){var u=s[o];if(u!==r[o]&&"*"!==u&&":"!==u.charAt(0))return!1}return!0},routeArguments:function(e,t){e||(e=i.activeRoute),t||(t=window.location.href);var n={},r=i.urlPath(t),s=r.split("/"),o=[];!e||!e.path||e.path instanceof RegExp||(o=e.path.split("/"));for(var u in o)if(o.hasOwnProperty(u)){var a=o[u];":"===a.charAt(0)&&(n[a.substring(1)]=s[u])}var f=t.indexOf("?"),l="";if(-1!==f){l=t.substring(f);var c=l.indexOf("#");-1!==c&&(l=l.substring(0,c))}var h=t.indexOf("#/"),p=t.indexOf("#!/");if(-1!==h||-1!==p){var d="";d=t.substring(-1!==h?h:p),f=d.indexOf("?"),-1!==f&&(l=d.substring(f))}var v=l.substring(1).split("&");1===v.length&&""===v[0]&&(v=[]);for(var m in v)if(v.hasOwnProperty(m)){var g=v[m],y=g.split("=");n[y[0]]=y.splice(1,y.length-1).join("=")}for(var b in n){var w=n[b];n[b]="true"===w?!0:"false"===w?!1:isNaN(w)||""===w?decodeURIComponent(w):+w}return n}};return i});