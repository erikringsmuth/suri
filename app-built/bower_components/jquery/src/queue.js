define(["./core","./deferred","./callbacks"],function(e){return e.extend({queue:function(t,n,r){var i;if(t)return n=(n||"fx")+"queue",i=e._data(t,n),r&&(!i||e.isArray(r)?i=e._data(t,n,e.makeArray(r)):i.push(r)),i||[]},dequeue:function(t,n){n=n||"fx";var r=e.queue(t,n),i=r.length,s=r.shift(),o=e._queueHooks(t,n),u=function(){e.dequeue(t,n)};s==="inprogress"&&(s=r.shift(),i--),s&&(n==="fx"&&r.unshift("inprogress"),delete o.stop,s.call(t,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(t,n){var r=n+"queueHooks";return e._data(t,r)||e._data(t,r,{empty:e.Callbacks("once memory").add(function(){e._removeData(t,n+"queue"),e._removeData(t,r)})})}}),e.fn.extend({queue:function(t,n){var r=2;return typeof t!="string"&&(n=t,t="fx",r--),arguments.length<r?e.queue(this[0],t):n===undefined?this:this.each(function(){var r=e.queue(this,t,n);e._queueHooks(this,t),t==="fx"&&r[0]!=="inprogress"&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(t,n){var r,i=1,s=e.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof t!="string"&&(n=t,t=undefined),t=t||"fx";while(u--)r=e._data(o[u],t+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}}),e});